{"version":3,"sources":["../../src/middlewares/authenticate.js"],"names":["Sequelize","models","Authenticate","verifyToken","req","res","next","headers","authorization","token","split","decoded","id","user","error"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAgBC,eAAtB;AACA;;;;;;AAKA,MAAMC,YAAN,CAAmB;AACjB;;;;;;;AAOA,eAAaC,WAAb,CAAyBC,GAAzB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACvC,QAAI;AACF,YAAM;AAAEC,QAAAA,OAAO,EAAE;AAAEC,UAAAA;AAAF;AAAX,UAAiCJ,GAAvC;AACA,YAAMK,KAAK,GAAGD,aAAa,CAACE,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAAd;;AACA,UAAI,CAACD,KAAD,IAAUA,KAAK,KAAK,EAAxB,EAA4B;AAC1B,eAAO,0BAAcJ,GAAd,EAAmB,GAAnB,EAAwB,gBAAxB,CAAP;AACD;;AACD,YAAMM,OAAO,GAAG,MAAM,wBAAYF,KAAZ,CAAtB;;AACA,UAAI,EAAEE,OAAO,IAAIA,OAAO,CAACC,EAArB,CAAJ,EAA8B;AAC5B,eAAO,0BAAcP,GAAd,EAAmB,GAAnB,EAAwB,yCAAxB,CAAP;AACD;;AACDD,MAAAA,GAAG,CAACS,IAAJ,GAAWF,OAAX;AACA,aAAOL,IAAI,EAAX;AACD,KAZD,CAYE,OAAOQ,KAAP,EAAc;AACd,aAAO,0BAAcT,GAAd,EAAmB,GAAnB,EAAwB,cAAxB,CAAP;AACD;AACF;;AAxBgB;;eA2BJH,Y","sourcesContent":["import { verifyToken, errorResponse } from '../utils';\nimport models from '../models';\n\nconst { Sequelize } = models;\n/**\n * @class Authenticate\n * @description authenticate tokens and roles\n * @exports Authenticate\n */\nclass Authenticate {\n  /**\n   * Verify if token is valid\n   * @param  {object} req - The user request object\n   * @param  {object} res - The user res response object\n   * @param  {function} next - The next() Function\n   * @returns {String} req.userId - The user id\n   */\n  static async verifyToken(req, res, next) {\n    try {\n      const { headers: { authorization } } = req;\n      const token = authorization.split(' ')[1];\n      if (!token || token === '') {\n        return errorResponse(res, 401, 'Access denied.');\n      }\n      const decoded = await verifyToken(token);\n      if (!(decoded && decoded.id)) {\n        return errorResponse(res, 401, 'Access denied. We could not verify user');\n      }\n      req.user = decoded;\n      return next();\n    } catch (error) {\n      return errorResponse(res, 500, 'Server error');\n    }\n  }\n}\n\nexport default Authenticate;\n"],"file":"authenticate.js"}